<%- include('partials/header') %>

    <section class="hero">
        <h1>Top Recommended Products</h1>
        <p>Handpicked deals from top marketplaces just for you.</p>
    </section>

    <div class="filters">
        <% categories.forEach(category=> { %>
            <a href="/?category=<%= category %>"
                class="filter-btn <%= selectedCategory === category ? 'active' : '' %>">
                <%= category %>
            </a>
            <% }) %>
    </div>

    <div class="product-grid">
        <% if (products.length===0) { %>
            <p>No products found in this category.</p>
            <% } else { %>
                <% products.forEach(product=> { %>
                    <div class="product-card">
                        <img src="<%= product.imageUrl %>" alt="<%= product.name %>" class="product-image"
                            onerror="this.src='https://via.placeholder.com/300x200?text=Image+Not+Found'">
                        <div class="product-info">
                            <span class="product-category">
                                <%= product.category %>
                            </span>
                            <h2 class="product-name">
                                <%= product.name %>
                            </h2>
                            <p class="product-description modal-trigger" data-title="<%= product.name %>"
                                data-desc="<%= product.description %>">
                                <%= product.description %>
                            </p>
                            <span class="read-more modal-trigger" data-title="<%= product.name %>"
                                data-desc="<%= product.description %>">View Details</span>
                            <div class="product-price">â‚¹<%= product.price %>
                            </div>
                            <div class="price-timestamp"
                                style="font-size: 0.75rem; color: #777; margin-top: -0.5rem; margin-bottom: 1rem;">
                                as of <%= product.lastUpdated ? new Date(product.lastUpdated).toLocaleString() : new
                                    Date().toLocaleString() %>
                            </div>
                            <a href="<%= product.affiliateLink %>" target="_blank" rel="sponsored nofollow noopener"
                                class="btn-amazon">View on Amazon</a>
                        </div>
                    </div>
                    <% }) %>
                        <% } %>
    </div>

    <!-- Modal Structure -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modalTitle" class="modal-title"></h2>
            <div id="modalBody" class="modal-body"></div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('productModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeBtn = document.querySelector('.close-modal');

        document.querySelectorAll('.modal-trigger').forEach(trigger => {
            trigger.addEventListener('click', () => {
                modalTitle.innerText = trigger.getAttribute('data-title');
                modalBody.innerText = trigger.getAttribute('data-desc');
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
        });

        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        closeBtn.onclick = closeModal;

        window.onclick = function (event) {
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>

    <%- include('partials/disclaimer') %>
        <%- include('partials/footer') %>